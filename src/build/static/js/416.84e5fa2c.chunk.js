"use strict";(self.webpackChunkstudent_typescript=self.webpackChunkstudent_typescript||[]).push([[416],{20416:(e,i,t)=>{t.r(i),t.d(i,{GuestUser:()=>oe,default:()=>re});var n=t(24836),s=t(96446),l=t(25754),o=t(60587),r=t(85865),d=t(88911),a=t(11906),c=t(90035),u=t(65043),v=t(29378),p=t(67784),x=t(51787),h=t(68903),g=t(12110),f=t(74354),m=t(81637),j=t(54536),y=t(8563),A=t(99380),b=t(25013),_=t(54712),w=t(18723),S=t(8064),C=t(66748),k=t(33438),F=t(78619),M=t(87977),I=t(70579);const R=e=>{let{content:i}=e;const t=M.A.sanitize(i);return(0,I.jsx)(F.o,{components:{a:e=>{let{href:i,children:t,...n}=e;return(0,I.jsx)("a",{href:i,target:"_blank",rel:"noopener noreferrer",...n,children:t})}},children:t})};var z=t(88266),N=t(61610);const T=u.forwardRef((function(e,i){return(0,I.jsx)(n.A,{direction:"up",ref:i,...e})})),B=e=>{var i;let{open:t,setOpen:n,id:l,type:x}=e;const g=(0,v.GV)((e=>e.sharedInfo)),F=(0,v.GV)((e=>e.BlockedList)),M=(0,v.GV)((e=>e.advisor)),B=(0,u.useRef)([]),[E,V]=(0,u.useState)(!1),O=(0,v.GV)((e=>e.messages)),[P,D]=(0,u.useState)([]),[L,H]=(0,u.useState)(null),[W,G]=(0,u.useState)(!1),[U,q]=(0,u.useState)(""),[Y,Z]=(0,u.useState)(!1),[J,K]=(0,u.useState)(""),Q=(0,v.GV)((e=>{let i=e.chats;return"advisors"===x?i.data.advisors.find((e=>e._id===l)):i.data.community.find((e=>e._id===l))})),X=(0,v.jL)(),$=null===Q||void 0===Q?void 0:Q.participants.find((e=>{var i;return e._id!==(null===g||void 0===g||null===(i=g.data)||void 0===i?void 0:i._id)})),ee=null===M||void 0===M||null===(i=M.data)||void 0===i?void 0:i.find((e=>{var i;return(null===e||void 0===e||null===(i=e.info)||void 0===i?void 0:i._id)===(null===$||void 0===$?void 0:$._id)})),ie=async()=>{const e=await(0,b.de)(l);if(e.success&&(X((0,w.wi)(e.data)),g.data&&g.data._id&&Object.values(g.data).every((e=>void 0!==typeof e)))){let i={action:"seen",sender:{...g.data,userType:"student"},recievers:null===Q||void 0===Q?void 0:Q.participants.filter((e=>{var i;return e._id!==(null===(i=g.data)||void 0===i?void 0:i._id)})),data:e.data};C.A.emit("trigger",i)}},te=e=>{if("send"===e.action)X((0,_.tj)({...e.data.message,type:"normal"})),ie()},ne=async e=>{let i;switch(e.name){case"send":const s=new FormData;if(!e.data.trim()&&0===P.length)return void console.error("No message content or valid files to upload.");s.append("content",e.data),s.append("chatId",l);let o=0;if(P.length>0){const i=["image/jpeg","image/jpg","image/png","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],t=P.filter((e=>{const t=i.includes(null===e||void 0===e?void 0:e.type),n=(null===e||void 0===e?void 0:e.size)<=16777216;return t&&n}));if(0===t.length&&!e.data)return;if(t.forEach((e=>{s.append("uploaded_file",e),o+=e.size})),0===t.length&&!e.data.trim())return void console.error("No valid files selected and no message content.")}try{if(e.data.trim()||o>0){const e=await(0,b._N)(s);if(e.data.success){X((0,w.wi)(e.data.data.chat)),X((0,_.tj)(e.data.data.message));const i={action:"send",sender:{...g.data,userType:"student"},recievers:null===Q||void 0===Q?void 0:Q.participants.filter((e=>{var i;return e._id!==(null===(i=g.data)||void 0===i?void 0:i._id)})),data:e.data.data};C.A.emit("trigger",i),D([])}else console.error("Failed to send message or upload files.")}}catch(t){console.error("Error during file upload or message sending:",t)}break;case"startTyping":i={action:"typing",sender:{...g.data,userType:"student"},recievers:null===Q||void 0===Q?void 0:Q.participants.filter((e=>{var i;return e._id!=(null===(i=g.data)||void 0===i?void 0:i._id)})),data:"start"},C.A.emit("trigger",i);break;case"stopTyping":i={action:"typing",sender:{...g.data,userType:"student"},recievers:null===Q||void 0===Q?void 0:Q.participants.filter((e=>{var i;return e._id!=(null===(i=g.data)||void 0===i?void 0:i._id)})),data:"stop"},C.A.emit("trigger",i);break;case"block":try{const i=await(0,b.wy)(J,e.data.id);X("block"===J?(0,N.EP)(i.data.data.blocked):(0,N.Rf)(i.data.data.blocked._id))}catch(n){console.log(n)}}};(0,u.useEffect)((()=>(C.A.removeListener("trigger",te),C.A.on("trigger",te),(async()=>{console.log("Fetching Messages");try{V(!0);const e=await(0,b.qH)(l);if(e){let i=e.data.map((e=>({...e,type:"normal"})));i.reverse(),X((0,_.bq)({requestStatus:"initiated",responseStatus:"recieved",haveAnIssue:!1,issue:"",data:i})),0!=(null===Q||void 0===Q?void 0:Q.unSeenMessages.filter((e=>{var i;return e.message.sender._id!==(null===(i=g.data)||void 0===i?void 0:i._id)})).filter((e=>!e.seen.find((e=>{var i;return e===(null===(i=g.data)||void 0===i?void 0:i._id)})))).length)&&await ie()}V(!1)}catch(e){}V(!1)})(),()=>{C.A.removeListener("trigger",te)})),[]),B.current=Q&&g.data?((e,i,t)=>{let n=i.participants.filter((e=>e._id!=t._id)),s=[],l=[];e.reverse(),e.forEach((e=>{var o;if((null===(o=e.sender)||void 0===o?void 0:o._id)==t._id)if(0!=n.length){if(0==i.unSeenMessages.length?0!=n.length&&(l=[...n]):l=i.unSeenMessages.find((i=>i.message._id==e._id))?n.filter((t=>{var n;return null===(n=i.unSeenMessages.find((i=>i.message._id==e._id)))||void 0===n?void 0:n.seen.find((e=>e==t._id))})):[...n],0!=l.length){let t=l.reduce(((e,i)=>e+i.firstName+" , "),"Seen by ");s.push({_id:e._id+"_seen",type:"seen",content:t.substring(0,t.length-3),chat:i._id})}s.push(e),n=n.filter((e=>!l.find((i=>i._id==e._id))))}else s.push(e);else s.push(e)})),s.reverse();let o=i.participants.filter((e=>"typing"==e.activity));if(0!=o.length){let e=o.reduce(((e,i)=>i.firstName+" , "),"");s.push({_id:i._id+"_typing",type:"typing",content:e.substring(0,e.length-3)+(1==o.length?" is typing":" are typing"),chat:i._id,sender:{displayPicSrc:"",firstName:"",lastName:"",email:"",_id:i._id+"_typing",userType:""}})}return s})([...O.data],Q,g.data):[];const se=e=>(0,I.jsx)("div",{style:{background:"#F8F8FC",padding:"0.5rem",borderRadius:"0.8rem",position:"relative"},children:(0,I.jsxs)(d.A,{direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",children:[(0,I.jsxs)(s.A,{sx:{display:"flex",gap:"1rem",alignItems:"center"},children:[(0,I.jsx)(o.A,{src:"Virtual_Assistant"===(null===$||void 0===$?void 0:$.role)?y.A.ai:null===$||void 0===$?void 0:$.displayPicSrc,alt:"profile",sx:{width:"3rem",height:"3rem",borderRadius:"50%"}}),(0,I.jsx)(r.A,{fontWeight:"500",sx:{position:"absolute",right:"10px",top:"-1rem",background:"#fff",p:1,borderRadius:"10px",color:"counsellor"===(null===$||void 0===$?void 0:$.role)?"#3B3F76":"processCoordinator"===(null===$||void 0===$?void 0:$.role)?"#569228":"#FEB853",fontSize:"14px"},children:null!==$&&void 0!==$&&$.role?(0,f.AZ)(null===$||void 0===$?void 0:$.role):null===$||void 0===$?void 0:$.role}),(0,I.jsx)(s.A,{children:null!==$&&void 0!==$&&$.firstName||null!==$&&void 0!==$&&$.lastName?(0,I.jsxs)(r.A,{fontWeight:"500",sx:{cursor:"pointer","&:hover":{color:"#4CAF50",textDecoration:"underline"}},onClick:()=>{console.log("Advisor name clicked!"),console.log("participantDetails:",$),console.log("advisorData:",ee),console.log("All advisors data:",null===M||void 0===M?void 0:M.data);let e=ee;var i;!e&&null!==$&&void 0!==$&&$._id&&(e=null===M||void 0===M||null===(i=M.data)||void 0===i?void 0:i.find((e=>{var i;return(null===e||void 0===e||null===(i=e.info)||void 0===i?void 0:i._id)===$._id||(null===e||void 0===e?void 0:e._id)===$._id})),console.log("Found advisor data after retry:",e));if(null!==$&&void 0!==$&&$.role&&"Virtual_Assistant"!==(null===$||void 0===$?void 0:$.role)){console.log("Opening advisor popup...");const i=e||{_id:$._id,info:$,assignedCountries:[]};X((0,S.DE)({show:!0,data:{container:{name:"advisor",data:i,dimensions:{width:"1200px",height:"85%"}},type:"custom"}}))}else console.log("Conditions not met for opening popup"),console.log("role:",null===$||void 0===$?void 0:$.role),console.log("isVirtualAssistant:","Virtual_Assistant"===(null===$||void 0===$?void 0:$.role))},children:[(0,f.r0)(null===$||void 0===$?void 0:$.firstName),"\xa0",(0,f.r0)(null===$||void 0===$?void 0:$.lastName)]}):(0,I.jsx)(r.A,{children:"User"})})]}),"member"!==(null===$||void 0===$?void 0:$.userType)&&(0,I.jsx)(s.A,{sx:{float:"right"},children:(0,I.jsx)(a.A,{sx:{textTransform:"none",color:"#3b3f76",float:"right"},onClick:()=>{const i=F.data.some((e=>(null===e||void 0===e?void 0:e._id)===(null===$||void 0===$?void 0:$._id)));K(i?"unblock":"block"),e.setBlockOpen(!0)},children:F.data.some((e=>(null===e||void 0===e?void 0:e._id)===(null===$||void 0===$?void 0:$._id)))?"Unblock":"Block"})})]})}),le=()=>{const e=(0,u.useRef)(null),i=(0,u.useRef)(null),[t,n]=(0,u.useState)(!0);return(0,u.useEffect)((()=>{var i;t&&(null===(i=e.current)||void 0===i||i.scrollIntoView({behavior:"auto"}))}),[B.current]),(0,u.useEffect)((()=>{var i;null===(i=e.current)||void 0===i||i.scrollIntoView({behavior:"auto"})}),[]),(0,I.jsxs)(s.A,{ref:i,onScroll:()=>{if(i.current){const{scrollTop:e,scrollHeight:t,clientHeight:s}=i.current;n(t-e-s<=5)}},sx:{overflowY:"scroll",mt:3,height:"390px","&::-webkit-scrollbar":{width:"12px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"transparent",borderRadius:"8px"}},children:[E?(0,I.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px"},children:(0,I.jsx)(m.A,{})}):(0,I.jsx)("div",{className:"chat-container",children:B.current.length>0?(0,I.jsxs)(I.Fragment,{children:[B.current.map((e=>{var i,t,n,s,l,r,d,a,c;return(0,I.jsx)(I.Fragment,{children:"seen"!==e.type&&"typing"!==e.type?(0,I.jsxs)("div",{className:"message ".concat((null===e||void 0===e||null===(i=e.sender)||void 0===i?void 0:i._id)===(null===(t=g.data)||void 0===t?void 0:t._id)?"sent":"received"),children:[(0,I.jsx)(R,{content:e.content}),null!==e&&void 0!==e&&null!==(n=e.document)&&void 0!==n&&null!==(s=n.data)&&void 0!==s&&s.preview_url?(0,I.jsx)("iframe",{src:null===e||void 0===e||null===(l=e.document)||void 0===l||null===(r=l.data)||void 0===r?void 0:r.preview_url,title:"preview",style:{border:"none",width:"150px",height:"150px",objectFit:"contain"}}):"",(0,I.jsx)(o.A,{src:null===(d=e.sender)||void 0===d?void 0:d.displayPicSrc,alt:"",sx:(null===e||void 0===e||null===(a=e.sender)||void 0===a?void 0:a._id)===(null===(c=g.data)||void 0===c?void 0:c._id)?{width:"1.5rem",height:"1.5rem",borderRadius:"50%",position:"absolute",top:"-12px",right:0}:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",position:"absolute",top:"-12px",left:0}})]},e._id):(0,I.jsx)("div",{className:"seenMsg",children:e.content})})})),(0,I.jsx)("div",{ref:e}),"          "]}):$?(0,I.jsx)(r.A,{textAlign:"center",children:"Start chat"}):(0,I.jsx)(r.A,{textAlign:"center",children:"No chat"})}),"  ",F.data.some((e=>(null===e||void 0===e?void 0:e._id)===(null===$||void 0===$?void 0:$._id)))&&(0,I.jsx)(r.A,{textAlign:"center",fontSize:"0.9rem",children:"You blocked this member."})]})},oe=e=>{const[i,t]=(0,u.useState)(""),[s,l]=(0,u.useState)(!1),o=(0,u.useRef)(null),d=async()=>{try{""!==i.trim()||P&&P.length>0?(l(!0),n(!0),await e.eventHandler({name:"send",data:i})):console.log("No content or files to send.")}catch(t){console.error("Error while sending:",t)}finally{l(!1)}};return(0,I.jsx)(I.Fragment,{children:$&&(0,I.jsxs)("div",{style:{position:"relative"},children:[(null===P||void 0===P?void 0:P.length)>0&&(0,I.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"absolute",top:"-44px",right:"35%"},children:(0,I.jsxs)("div",{style:{width:"fitContent"},children:[(0,I.jsx)(r.A,{fontSize:"0.9rem",children:"Selected files:"}),(0,I.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:P.map(((e,i)=>(0,I.jsxs)("li",{style:{fontSize:"12px",display:"flex"},children:[e.name,(0,I.jsx)(k.A,{onClick:()=>(e=>{const i=[...P];i.splice(e,1),D(i)})(i),sx:{fontSize:"1rem",cursor:"pointer"}})]},i)))})]})}),W?(0,I.jsx)("div",{className:"replyDiv",children:(0,I.jsxs)("h5",{children:["reply to:- ",U]})}):"",F.data.some((e=>(null===e||void 0===e?void 0:e._id)===(null===$||void 0===$?void 0:$._id)))?"":(0,I.jsxs)(h.Ay,{container:!0,sx:{background:"#F8F8FC",padding:"0.5rem",borderRadius:"0.8rem"},children:[(0,I.jsx)(h.Ay,{item:!0,xs:1,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,I.jsxs)("div",{children:[(0,I.jsx)("input",{type:"file",multiple:!0,style:{display:"none"},onChange:e=>{const i=Array.from(e.target.files);D(i)},ref:o}),(0,I.jsx)(A.A,{sx:{color:"",cursor:"pointer"},onClick:()=>{var e;return null===o||void 0===o||null===(e=o.current)||void 0===e?void 0:e.click()}})]})}),(0,I.jsx)(h.Ay,{item:!0,xs:9.5,children:(0,I.jsx)(p.A,{variant:"outlined",size:"small",onFocus:()=>e.eventHandler({name:"startTyping"}),onBlur:()=>e.eventHandler({name:"stopTyping"}),multiline:!0,rows:2,fullWidth:!0,value:i,placeholder:"Type your message...",sx:{"& .MuiOutlinedInput-notchedOutline":{border:0,"&:Focus":{border:0}},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{border:"none !important"}},onChange:e=>t(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||""===i.trim()||(e.preventDefault(),d())}})}),(0,I.jsx)(h.Ay,{item:!0,xs:1.5,sx:{display:"flex",justifyContent:"center",alignItems:"center",background:"#fff",borderRadius:"6px"},children:s?(0,I.jsx)("img",{src:y.A.standardLoader,alt:"loader",style:{width:"1rem"}}):(0,I.jsx)("img",{src:y.A.sendIcon,alt:"sendIcon",style:{width:"2rem",height:"2rem"},onClick:d})})]})]})})};return(0,I.jsxs)("div",{children:[(0,I.jsxs)(c.A,{open:t,sx:{right:"0",left:{md:"45%",xs:"0",lg:"68%"},top:{md:"10px",xs:"0",lg:"25px"}},PaperProps:{style:{borderRadius:"1rem",padding:"1rem",width:"410px",height:"582px"}},TransitionComponent:T,keepMounted:!0,onClose:()=>n(!1),"aria-describedby":"alert-dialog-slide-description",children:[(0,I.jsx)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,I.jsx)(j.A,{sx:{position:"absolute",top:0,color:"#0F0F0F",fontSize:"2rem",cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>n(!1)})}),(0,I.jsxs)(s.A,{sx:{mt:3},children:[(0,I.jsx)(se,{eventHandler:ne,setBlockOpen:Z}),(0,I.jsx)(le,{}),(0,I.jsx)(oe,{eventHandler:ne})]})]}),(0,I.jsx)(z.A,{open:Y,handleClose:()=>Z(!1),additionalData:{onSubmit:()=>ne({name:"block",data:{id:null===$||void 0===$?void 0:$._id}}),title:"Are you sure you want to ".concat(J," this user?"),content:""}})]})};var E=t(53253),V=t(13383);const O=e=>{var i;const[t,n]=(0,u.useState)(!1),l=(0,v.GV)((e=>e.sharedInfo)),d=null===l||void 0===l?void 0:l.data,a=d?((e,i)=>{var t,n,s;let l={dp:"",name:"",unseenMessages:0,activeParticipants:[],chatType:"1-1",lastMessage:void 0,role:""},o=null===e||void 0===e||null===(t=e.participants)||void 0===t?void 0:t.find((e=>e._id===i._id)),r=null===e||void 0===e||null===(n=e.participants)||void 0===n?void 0:n.filter((e=>e._id!==i._id));var d,a,c,u,v,p;(null===e||void 0===e||null===(s=e.participants)||void 0===s?void 0:s.length)<=2?(l.name=(null===r||void 0===r?void 0:r.length)>0?(null!==r&&void 0!==r&&null!==(d=r[0])&&void 0!==d&&d.firstName?null===r||void 0===r||null===(a=r[0])||void 0===a?void 0:a.firstName:"user")+(null!==r&&void 0!==r&&null!==(c=r[0])&&void 0!==c&&c.lastName?" "+(null===r||void 0===r||null===(u=r[0])||void 0===u?void 0:u.lastName):""):"Deleted User",l.dp=(null===r||void 0===r?void 0:r.length)>0?null===r||void 0===r||null===(v=r[0])||void 0===v?void 0:v.displayPicSrc:"",l.role=(null===r||void 0===r?void 0:r.length)>0?null===r||void 0===r||null===(p=r[0])||void 0===p?void 0:p.role:""):(l.chatType="group",l.name="Group Name");return l.unseenMessages=e.unSeenMessages.filter((e=>{var t,n;return(null===(t=e.message)||void 0===t||null===(n=t.sender)||void 0===n?void 0:n._id)!==(null===i||void 0===i?void 0:i._id)})).filter((e=>!e.seen.some((e=>e===i._id)))).length,e.lastMessage&&o&&(l.lastMessage=((e,i)=>{var t,n,s;let l={sender:(null===(t=e.lastMessage)||void 0===t?void 0:t.sender)===i._id?"current":"others",message:null!==(n=e.lastMessage)&&void 0!==n&&n.content?null===(s=e.lastMessage)||void 0===s?void 0:s.content:"",status:"seen"};if("current"===l.sender)l.status=-1===e.unSeenMessages.findIndex((i=>{var t;return i.message._id===(null===(t=e.lastMessage)||void 0===t?void 0:t._id)}))?"seen":"unseen";else{let t=e.unSeenMessages.findIndex((i=>{var t;return i.message._id===(null===(t=e.lastMessage)||void 0===t?void 0:t._id)}));l.status=-1===t?"seen":-1===e.unSeenMessages[t].seen.findIndex((e=>e===i._id))?"unseen":"seen"}return l})(e,o),l.activeParticipants=((e,i)=>{let t=e.participants.filter((e=>"inchat"===e.activity&&e._id!==i._id)),n=e.participants.filter((e=>"online"===e.activity&&e._id!==i._id));return[...e.participants.filter((e=>"typing"===e.activity&&e._id!==i._id)),...t,...n]})(e,o)),l})(e.data,d):null,c=()=>{var e,i,t,n,l,o,d,c;return(0,I.jsxs)("div",{style:{display:"flex",gap:"8px",width:"100%"},children:["current"===(null===a||void 0===a||null===(e=a.lastMessage)||void 0===e?void 0:e.sender)?(0,I.jsx)(I.Fragment,{children:"seen"===(null===a||void 0===a||null===(i=a.lastMessage)||void 0===i?void 0:i.status)?(0,I.jsx)(s.A,{sx:{display:"flex"},children:(0,I.jsx)(E.A,{sx:{color:"#2196f3",fontSize:"1rem"}})}):(0,I.jsx)(s.A,{sx:{display:"flex"},children:(0,I.jsx)(E.A,{sx:{color:"gray",fontSize:"1rem"}})})}):null,(0,I.jsxs)(r.A,{sx:{fontSize:"12px",width:"200px",height:"2rem",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",fontWeight:"current"===(null===a||void 0===a||null===(t=a.lastMessage)||void 0===t?void 0:t.sender)||"seen"===(null===a||void 0===a||null===(n=a.lastMessage)||void 0===n?void 0:n.status)?"300":"600",color:"current"===(null===a||void 0===a||null===(l=a.lastMessage)||void 0===l?void 0:l.sender)||"seen"===(null===a||void 0===a||null===(o=a.lastMessage)||void 0===o?void 0:o.status)?"#98999A":"#000"},children:[null===a||void 0===a||null===(d=a.lastMessage)||void 0===d?void 0:d.message,(0,I.jsx)(r.A,{variant:"body1",fontWeight:"400",color:"#000",fontSize:"0.8rem",children:null!==a&&void 0!==a&&null!==(c=a.lastMessage)&&void 0!==c&&c.message?"":"Tap to chat"})]})]})};return(0,I.jsxs)("div",{style:{position:"relative"},children:[(0,I.jsx)(g.A,{sx:{pl:1,background:"#F8F8FC",borderRadius:"10px",boxShadow:0,cursor:"pointer"},onClick:()=>n(!0),children:(0,I.jsxs)(h.Ay,{container:!0,spacing:2,children:[(0,I.jsxs)(h.Ay,{item:!0,xs:2,sx:{display:"flex",justifyContent:"center",alignItems:"center",position:"relative"},children:[(0,I.jsx)(o.A,{src:"Virtual_Assistant"===(null===a||void 0===a?void 0:a.role)?y.A.ai:null===a||void 0===a?void 0:a.dp,alt:"logo",style:{width:"2.5rem",height:"2.5rem",borderRadius:"50%",marginLeft:"0.8rem"}}),"1-1"===(null===a||void 0===a?void 0:a.chatType)&&0!==(null===a||void 0===a?void 0:a.activeParticipants.length)&&"offline"!==(null===a||void 0===a?void 0:a.activeParticipants[0].activity)?(0,I.jsx)(V.A,{sx:{color:"green",fontSize:"1rem",position:"absolute",bottom:"10px",right:"-7px"}}):null]}),(0,I.jsxs)(h.Ay,{item:!0,xs:8,sx:{mt:1},children:[(0,I.jsx)(r.A,{fontWeight:"500",gutterBottom:!0,children:(0,f.r0)(null===a||void 0===a?void 0:a.name)}),"Deleted User"===(null===a||void 0===a?void 0:a.name)?(0,I.jsx)(s.A,{sx:{p:1}}):(0,I.jsx)(c,{})]}),(0,I.jsx)(h.Ay,{item:!0,xs:2,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,I.jsx)(r.A,{sx:{background:"#3b3f76",color:"#fff",borderRadius:"50%",width:"1rem",height:"1rem",border:"1px solid #3B3F76",fontSize:"11px",textAlign:"center"},children:null===a||void 0===a?void 0:a.unseenMessages})}),(0,I.jsx)(h.Ay,{item:!0,xs:12,sx:{position:"absolute",right:"10px",top:"-2rem"},children:(0,I.jsx)(r.A,{fontWeight:"500",sx:{background:"#fff",p:.5,borderRadius:"10px",color:"counsellor"===(null===a||void 0===a?void 0:a.role)?"#3B3F76":"processCoordinator"===(null===a||void 0===a?void 0:a.role)?"#569228":"#FEB853",fontSize:"14px"},children:null!==a&&void 0!==a&&a.role?(0,f.AZ)(null===a||void 0===a?void 0:a.role):null===a||void 0===a?void 0:a.role})})]})}),t?(0,I.jsx)(B,{open:t,setOpen:n,id:null===e||void 0===e||null===(i=e.data)||void 0===i?void 0:i._id,type:"advisors"}):null]})};var P=t(66360);const D=()=>{var e,i,t,n,l,d,a,c,g;const m=(0,v.GV)((e=>e.chats)),j=(0,v.GV)((e=>e.advisor)),y=(0,v.jL)(),[A,_]=(0,u.useState)(null),[S,C]=(0,u.useState)(null),[k,F]=(0,u.useState)(""),[M,R]=(0,u.useState)(null),z=e=>null===e||void 0===e?void 0:e.filter((e=>{var i;return!(null!==e&&void 0!==e&&null!==(i=e.participants)&&void 0!==i&&i.some((e=>"Virtual_Assistant"===e.role)))})),N=null===m||void 0===m||null===(e=m.data)||void 0===e||null===(i=e.advisors)||void 0===i?void 0:i.find((e=>{var i;return null===e||void 0===e||null===(i=e.participants)||void 0===i?void 0:i.find((e=>"Virtual_Assistant"===e.role))})),T=N?[N,...z((null===m||void 0===m||null===(t=m.data)||void 0===t?void 0:t.advisors)||[])]:z((null===m||void 0===m||null===(n=m.data)||void 0===n?void 0:n.advisors)||[]);console.log("Advisor Chats",T);const E=(null===j||void 0===j||null===(l=j.data)||void 0===l?void 0:l.filter((e=>{if(null===e||void 0===e||!e.info)return!1;const i="".concat((0,f.AZ)(e.info.firstName||"")," ").concat((0,f.AZ)(e.info.lastName||"")).toLowerCase(),t=(0,f.Tl)(e.info.role).toLowerCase(),n=k.toLowerCase();return i.includes(n)||t.includes(n)})))||[],V=async e=>{try{const i=await(0,b.V4)(e);return i&&i.data,i.data}catch(M){}};return(0,I.jsxs)(s.A,{sx:{overflowY:"scroll",height:"450px","&::-webkit-scrollbar":{width:"12px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#fff",borderRadius:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"#fff"},width:"100%",mt:1},children:[M&&(0,I.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",mb:2,p:2,backgroundColor:"#ffebee",borderRadius:"12px",mx:1},children:(0,I.jsx)(r.A,{color:"#d32f2f",fontSize:"0.9rem",children:M})}),(0,I.jsx)(s.A,{sx:{mb:3,px:1},children:(0,I.jsx)(p.A,{fullWidth:!0,placeholder:"Search advisors...",value:k,onChange:e=>F(e.target.value),InputProps:{startAdornment:(0,I.jsx)(x.A,{position:"start",children:(0,I.jsx)(P.A,{sx:{color:"#666"}})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:"12px",backgroundColor:"#fff","& fieldset":{borderColor:"#E0E0F6"},"&:hover fieldset":{borderColor:"#3B3F76"},"&.Mui-focused fieldset":{borderColor:"#3B3F76"}}}})}),k&&0===E.length&&(0,I.jsxs)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100px",flexDirection:"column",gap:1},children:[(0,I.jsxs)(r.A,{color:"#666",fontSize:"1rem",children:['No advisors found for "',k,'"']}),(0,I.jsx)(r.A,{color:"#999",fontSize:"0.8rem",children:"Try searching with a different term"})]}),(0,I.jsxs)(s.A,{children:[(0,I.jsx)(r.A,{color:"#3B3F76",fontSize:"1.1rem",fontWeight:600,mb:2,sx:{px:1},children:"Active Chats"}),(0,I.jsxs)(h.Ay,{container:!0,spacing:2,children:[T&&(null===m||void 0===m||null===(d=m.data)||void 0===d||null===(a=d.advisors)||void 0===a?void 0:a.length)>0&&(null===T||void 0===T?void 0:T.map(((e,i)=>(0,I.jsx)(h.Ay,{item:!0,xs:12,children:(0,I.jsx)(O,{data:e})},(null===e||void 0===e?void 0:e._id)||i)))),E.map(((e,i)=>{try{var t,n,l,d,a;const c=(e=>{var i,t;return null===m||void 0===m||null===(i=m.data)||void 0===i||null===(t=i.advisors)||void 0===t?void 0:t.find((i=>{var t;return null===i||void 0===i||null===(t=i.participants)||void 0===t?void 0:t.some((i=>{var t;return(null===i||void 0===i?void 0:i._id)===(null===e||void 0===e||null===(t=e.info)||void 0===t?void 0:t._id)}))}))})(e);return null===e||void 0===e||!e.info||c?null:(0,I.jsx)(h.Ay,{item:!0,xs:12,children:(0,I.jsxs)(s.A,{sx:{display:"flex",alignItems:"center",background:"#fff",borderRadius:"12px",p:2,boxShadow:"0px 2px 8px 0px #E0E0F6",border:"2px solid transparent",cursor:"pointer","&:hover":{boxShadow:"0px 4px 12px 0px #E0E0F6"},mb:1,opacity:A===e._id?.7:1},onClick:()=>(async e=>{if(null!==e&&void 0!==e&&e._id){_(e._id);try{var i,t;const l=null===m||void 0===m||null===(i=m.data)||void 0===i||null===(t=i.advisors)||void 0===t?void 0:t.find((i=>{var t;return null===i||void 0===i||null===(t=i.participants)||void 0===t?void 0:t.some((i=>{var t;return(null===i||void 0===i?void 0:i._id)===(null===e||void 0===e||null===(t=e.info)||void 0===t?void 0:t._id)}))}));if(l)C(l._id);else if(e.assignedCountries&&e.assignedCountries.length>0){var n,s;const i=await V(e.info._id);null!==i&&void 0!==i&&null!==(n=i.data)&&void 0!==n&&null!==(s=n.data)&&void 0!==s&&s.chat&&(y((0,w.Nl)(i.data)),C(i.data._id))}else console.error("No assigned countries found for advisor")}catch(M){console.error("Error opening chat:",M),R("Failed to open chat. Please try again.")}finally{_(null)}}else console.error("Advisor ID is missing")})(e),children:[(0,I.jsx)(o.A,{src:null===e||void 0===e||null===(t=e.info)||void 0===t?void 0:t.displayPicSrc,alt:"pic",sx:{width:40,height:40,mr:2,boxShadow:"0 1px 4px #E0E0F6"}}),(0,I.jsxs)(s.A,{sx:{flex:1},children:[(0,I.jsxs)(r.A,{fontWeight:700,color:"#3B3F76",fontSize:"1rem",lineHeight:1.3,children:[(0,f.AZ)((null===e||void 0===e||null===(n=e.info)||void 0===n?void 0:n.firstName)||"")," ",(0,f.AZ)((null===e||void 0===e||null===(l=e.info)||void 0===l?void 0:l.lastName)||"")]}),(0,I.jsx)(r.A,{color:"#666",fontSize:"0.85rem",fontWeight:400,lineHeight:1.3,children:(0,f.Tl)(null===e||void 0===e||null===(d=e.info)||void 0===d?void 0:d.role)})]}),(0,I.jsx)(s.A,{sx:{display:"inline-block",px:1.5,py:.3,borderRadius:"12px",background:"#E6E6FA",border:"1px solid #3B3F76",mr:1},children:(0,I.jsx)(r.A,{fontSize:"0.65rem",color:"#3B3F76",fontWeight:600,children:(0,f.Tl)(null===e||void 0===e||null===(a=e.info)||void 0===a?void 0:a.role)})}),(0,I.jsx)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:"50%",background:"#3B3F76",color:"#fff"},children:(0,I.jsx)(r.A,{fontSize:"0.6rem",fontWeight:600,children:A===e._id?"...":"!"})})]})},e._id||i)}catch(c){return console.error("Error rendering advisor:",c),null}}))]})]}),(!(null!==j&&void 0!==j&&j.data)||0===j.data.length)&&(!T||0===(null===m||void 0===m||null===(c=m.data)||void 0===c||null===(g=c.advisors)||void 0===g?void 0:g.length))&&(0,I.jsxs)(s.A,{sx:{height:"5rem",borderRadius:"20px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",width:"100%",gap:2},children:[(0,I.jsx)(r.A,{color:"#3B3F76",children:"No advisors assigned"}),(0,I.jsx)(r.A,{color:"#666",fontSize:"0.8rem",children:"Contact support to get assigned an advisor"})]}),S&&(0,I.jsx)(B,{open:!!S,setOpen:()=>C(null),id:S,type:"advisors"})]})},L=e=>{var i;const[t,n]=(0,u.useState)(!1),l=(0,v.GV)((e=>e.sharedInfo)),d=null===l||void 0===l?void 0:l.data,a=d?((e,i)=>{let t={dp:"",name:"",unseenMessages:0,activeParticipants:[],chatType:"1-1",lastMessage:void 0},n=e.participants.find((e=>e._id===i._id)),s=e.participants.filter((e=>e._id!==i._id));var l,o,r,d;e.participants.length<=2?(t.name=(null===s||void 0===s?void 0:s.length)>0?(null!==s&&void 0!==s&&null!==(l=s[0])&&void 0!==l&&l.firstName?null===s||void 0===s||null===(o=s[0])||void 0===o?void 0:o.firstName:"user")+(null!==s&&void 0!==s&&null!==(r=s[0])&&void 0!==r&&r.lastName?" "+(null===s||void 0===s||null===(d=s[0])||void 0===d?void 0:d.lastName):""):"Deleted User",t.dp=(null===s||void 0===s?void 0:s.length)>0?null===s||void 0===s?void 0:s[0].displayPicSrc:""):(t.chatType="group",t.name="Group Name");return t.unseenMessages=e.unSeenMessages.filter((e=>{var t,n;return(null===e||void 0===e||null===(t=e.message)||void 0===t||null===(n=t.sender)||void 0===n?void 0:n._id)!==(null===i||void 0===i?void 0:i._id)})).filter((e=>!e.seen.some((e=>e===i._id)))).length,e.lastMessage&&n&&(t.lastMessage=((e,i)=>{var t,n,s;let l={sender:(null===(t=e.lastMessage)||void 0===t?void 0:t.sender)===i._id?"current":"others",message:null!==(n=e.lastMessage)&&void 0!==n&&n.content?null===(s=e.lastMessage)||void 0===s?void 0:s.content:"",status:"seen"};if("current"===l.sender)l.status=-1===e.unSeenMessages.findIndex((i=>{var t;return i.message._id===(null===(t=e.lastMessage)||void 0===t?void 0:t._id)}))?"seen":"unseen";else{let t=e.unSeenMessages.findIndex((i=>{var t;return i.message._id===(null===(t=e.lastMessage)||void 0===t?void 0:t._id)}));l.status=-1===t?"seen":-1===e.unSeenMessages[t].seen.findIndex((e=>e===i._id))?"unseen":"seen"}return l})(e,n),t.activeParticipants=((e,i)=>{let t=e.participants.filter((e=>"inchat"===e.activity&&e._id!==i._id)),n=e.participants.filter((e=>"online"===e.activity&&e._id!==i._id));return[...e.participants.filter((e=>"typing"===e.activity&&e._id!==i._id)),...t,...n]})(e,n)),t})(e.data,d):null,c=()=>{var e,i,t,n,l,o,d,c;return(0,I.jsxs)("div",{style:{display:"flex",gap:"8px",width:"100%"},children:["current"===(null===a||void 0===a||null===(e=a.lastMessage)||void 0===e?void 0:e.sender)?(0,I.jsx)(I.Fragment,{children:"seen"===(null===a||void 0===a||null===(i=a.lastMessage)||void 0===i?void 0:i.status)?(0,I.jsx)(s.A,{sx:{display:"flex"},children:(0,I.jsx)(E.A,{sx:{color:"#2196f3",fontSize:"1rem"}})}):(0,I.jsx)(s.A,{sx:{display:"flex"},children:(0,I.jsx)(E.A,{sx:{color:"gray",fontSize:"1rem"}})})}):null,(0,I.jsxs)(r.A,{sx:{fontSize:"12px",width:"200px",height:"2rem",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden",fontWeight:"current"===(null===a||void 0===a||null===(t=a.lastMessage)||void 0===t?void 0:t.sender)||"seen"===(null===a||void 0===a||null===(n=a.lastMessage)||void 0===n?void 0:n.status)?"300":"400",color:"current"===(null===a||void 0===a||null===(l=a.lastMessage)||void 0===l?void 0:l.sender)||"seen"===(null===a||void 0===a||null===(o=a.lastMessage)||void 0===o?void 0:o.status)?"#98999A":"#000"},children:[null===a||void 0===a||null===(d=a.lastMessage)||void 0===d?void 0:d.message,(0,I.jsx)(r.A,{variant:"body1",fontWeight:"400",color:"#000",fontSize:"0.8rem",children:null!==a&&void 0!==a&&null!==(c=a.lastMessage)&&void 0!==c&&c.message?"":"Tap to chat"})]})]})};return(0,I.jsxs)("div",{children:[(0,I.jsx)(g.A,{sx:{p:.5,background:"#F8F8FC",borderRadius:"10px",boxShadow:0,cursor:"pointer"},onClick:()=>n(!0),children:(0,I.jsxs)(h.Ay,{container:!0,spacing:2,children:[(0,I.jsxs)(h.Ay,{item:!0,xs:2,sx:{display:"flex",justifyContent:"center",alignItems:"center",position:"relative"},children:[(0,I.jsx)(o.A,{src:null===a||void 0===a?void 0:a.dp,alt:"logo",style:{width:"2.5rem",height:"2.5rem",borderRadius:"50%",marginLeft:"0.8rem"}}),"1-1"===(null===a||void 0===a?void 0:a.chatType)&&0!==(null===a||void 0===a?void 0:a.activeParticipants.length)&&"offline"!==(null===a||void 0===a?void 0:a.activeParticipants[0].activity)?(0,I.jsx)(V.A,{sx:{color:"green",fontSize:"1rem",position:"absolute",bottom:"10px",right:"-7px"}}):null]}),(0,I.jsxs)(h.Ay,{item:!0,xs:8,children:[(0,I.jsx)(r.A,{fontWeight:"500",gutterBottom:!0,children:(0,f.r0)(null===a||void 0===a?void 0:a.name)}),"Deleted User"===(null===a||void 0===a?void 0:a.name)?(0,I.jsx)(s.A,{sx:{p:1}}):(0,I.jsx)(c,{})]}),(0,I.jsx)(h.Ay,{item:!0,xs:2,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,I.jsx)(r.A,{sx:{background:"#3B3F76",color:"#fff",borderRadius:"50%",width:"1rem",height:"1rem",border:"1px solid #3B3F76",fontSize:"11px",textAlign:"center"},children:null===a||void 0===a?void 0:a.unseenMessages})})]})}),t?(0,I.jsx)(B,{open:t,setOpen:n,id:null===e||void 0===e||null===(i=e.data)||void 0===i?void 0:i._id,type:"community"}):null]})},H=()=>{var e,i,t,n;const l=(0,v.GV)((e=>e.chats));return(0,I.jsx)(s.A,{sx:{overflowY:"scroll",height:"450px","&::-webkit-scrollbar":{width:"12px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#fff",borderRadius:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"#fff"},width:"100%",mt:2},children:(0,I.jsx)(h.Ay,{container:!0,spacing:2,sx:{mt:0},children:(null===l||void 0===l||null===(e=l.data)||void 0===e||null===(i=e.community)||void 0===i?void 0:i.length)>0?null===l||void 0===l||null===(t=l.data)||void 0===t||null===(n=t.community)||void 0===n?void 0:n.map(((e,i)=>(0,I.jsx)(h.Ay,{item:!0,xs:12,children:(0,I.jsx)(L,{data:e})},i))):(0,I.jsx)(s.A,{sx:{height:"5rem",borderRadius:"20px",display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:(0,I.jsx)(r.A,{color:"#3B3F76",children:"Start a new chat"})})})})},W=()=>{var e,i;const[t,n]=(0,u.useState)(!0),l=(0,v.GV)((e=>e.chats)),d=null===l||void 0===l||null===(e=l.data)||void 0===e||null===(i=e.advisors)||void 0===i?void 0:i.find((e=>{var i;return null===(i=e.participants)||void 0===i?void 0:i.some((e=>"Virtual_Assistant"===e.role))}));return(0,I.jsxs)(s.A,{sx:{overflowY:"scroll",height:"450px","&::-webkit-scrollbar":{width:"12px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#fff",borderRadius:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"#fff"},width:"100%",mt:1},children:[(0,I.jsx)(h.Ay,{container:!0,spacing:2,sx:{mt:0},children:d?(0,I.jsx)(h.Ay,{item:!0,xs:12,children:(0,I.jsx)(O,{data:d})}):(0,I.jsx)(h.Ay,{item:!0,xs:12,children:(0,I.jsx)(g.A,{sx:{pl:1,background:"#F8F8FC",borderRadius:"10px",boxShadow:0,p:2},children:(0,I.jsxs)(h.Ay,{container:!0,spacing:2,alignItems:"center",children:[(0,I.jsx)(h.Ay,{item:!0,xs:2,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,I.jsx)(o.A,{src:y.A.ai,alt:"Ava Lite",style:{width:"2.5rem",height:"2.5rem",borderRadius:"50%"}})}),(0,I.jsxs)(h.Ay,{item:!0,xs:8,children:[(0,I.jsx)(r.A,{fontWeight:"500",gutterBottom:!0,children:"Ava Lite"}),(0,I.jsx)(r.A,{variant:"body2",color:"#98999A",children:"Tap to chat"})]}),(0,I.jsx)(h.Ay,{item:!0,xs:2,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,I.jsx)(r.A,{sx:{background:"#3b3f76",color:"#fff",borderRadius:"50%",width:"1rem",height:"1rem",border:"1px solid #3B3F76",fontSize:"11px",textAlign:"center"},children:"0"})}),(0,I.jsx)(h.Ay,{item:!0,xs:12,sx:{position:"absolute",right:"10px",top:"-2rem"},children:(0,I.jsx)(r.A,{fontWeight:"500",sx:{background:"#fff",p:.5,borderRadius:"10px",color:"#F48438",fontSize:"14px"},children:"Virtual_Assistant"})})]})})})}),t&&(0,I.jsx)(B,{open:t,setOpen:n,id:(null===d||void 0===d?void 0:d._id)||"new",type:"advisors"})]})};var G=t(22505),U=t(84311),q=t(57566);const Y=u.forwardRef((function(e,i){return(0,I.jsx)(n.A,{direction:"up",ref:i,...e})})),Z=e=>{let{eventHandler:i,options:t,friends:n}=e;return(0,I.jsxs)(d.A,{spacing:1,className:"chat-container-messenger1",sx:{mt:2,height:"480px"},children:[(0,I.jsx)(r.A,{textAlign:"center",fontWeight:"600",children:"New Chat"}),(0,I.jsx)(p.A,{size:"small",fullWidth:!0,onChange:e=>i({name:"handleChange",data:e}),id:"outlined-basic",placeholder:"Search",variant:"outlined",autoComplete:"false",sx:{"& .MuiOutlinedInput-root":{borderRadius:"10px"}},InputProps:{startAdornment:(0,I.jsx)(x.A,{position:"start",children:(0,I.jsx)(P.A,{})})}}),(0,I.jsx)(s.A,{sx:{height:"420px",overflowY:"scroll",p:1},children:t.map(((e,t)=>{var s;return(0,I.jsxs)(h.Ay,{container:!0,spacing:3,onClick:()=>i({name:"select",data:e}),sx:{p:0},children:[(0,I.jsx)(h.Ay,{item:!0,xs:2,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,I.jsx)(o.A,{src:e.displayPicSrc,alt:"profile",style:{width:"2rem",height:"2rem",borderRadius:"50%"}})}),(0,I.jsx)(h.Ay,{item:!0,xs:8,children:(0,I.jsx)("h5",{children:(0,f.r0)(e.firstName)+" "+(0,f.r0)(null===e||void 0===e?void 0:e.lastName)})}),(0,I.jsx)(h.Ay,{item:!0,xs:2,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:null!==(s=n.current)&&void 0!==s&&s.find((i=>i._id===e._id))?(0,I.jsx)("span",{style:{color:"rgb(255, 117, 26)"},children:"Friend"}):(0,I.jsx)(q.A,{sx:{fontSize:"1.2rem",color:"teal"}})})]},t)}))})]})},J=e=>{var i,t;let{open:n,setOpen:l}=e;const[o,r]=(0,u.useState)(null),[d,a]=(0,u.useState)(!1),[p,x]=(0,u.useState)([]),h=(0,v.GV)((e=>e.sharedInfo)),g=(0,v.GV)((e=>e.chats)),y=[...g.data.advisors,...g.data.community],A=(0,u.useRef)(null!==(i=h.data)&&void 0!==i&&i._id?(0,f.M7)(y,null===(t=h.data)||void 0===t?void 0:t._id):[]),_=(0,v.jL)();return(0,I.jsx)("div",{children:(0,I.jsx)(c.A,{open:n,sx:{right:"0",left:{md:"45%",xs:"0",lg:"68%"},top:{md:"10px",xs:"0",lg:"25px"}},PaperProps:{style:{borderRadius:"1rem",padding:"1rem",width:"410px",height:"550px"}},TransitionComponent:Y,keepMounted:!0,onClose:()=>l(!1),"aria-describedby":"alert-dialog-slide-description",children:d?(0,I.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px"},children:(0,I.jsx)(m.A,{})}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,I.jsx)(j.A,{onClick:()=>l(!1),sx:{width:"2rem",height:"2rem"}})}),(0,I.jsx)(Z,{searchTerm:o,eventHandler:async e=>{switch(e.name){case"handleChange":""!==e.data.target.value&&(r(e.data.target.value),(async e=>{const i=await(0,b.iT)(e);var t;i&&void 0!==i.data&&x(null===i||void 0===i||null===(t=i.data)||void 0===t?void 0:t.filter((e=>{var i;return e._id!==(null===(i=h.data)||void 0===i?void 0:i._id)})))})(e.data.target.value.trim()));break;case"select":a(!0),a(!1),l(!1);const i=await(async e=>{try{const i=await(0,b.V4)(e);return i&&i.data,i.data}catch(i){}})(e.data._id);_((0,w.Nl)(i))}},options:p,friends:A})]})})})};var K=t(47500),Q=t(76040),X=t(74802),$=t(86598),ee=t(88446);const ie=u.forwardRef((function(e,i){return(0,I.jsx)(n.A,{direction:"up",ref:i,...e})})),te=e=>{let{open:i,setOpen:t,id:n,type:l}=e;const x=(0,v.GV)((e=>e.sharedInfo)),g=(0,u.useRef)([]),[A,S]=(0,u.useState)(!1),F=(0,v.GV)((e=>e.messages)),[M,z]=(0,u.useState)([]),[N,T]=(0,u.useState)(null),[B,E]=(0,u.useState)(!1),[V,O]=(0,u.useState)(""),[P,D]=(0,u.useState)(""),L=(0,v.GV)((e=>{let i=e.chats;return"advisors"===l?i.data.advisors.find((e=>e._id===n)):i.data.community.find((e=>e._id===n))})),H=(0,v.jL)(),W=null===L||void 0===L?void 0:L.participants.find((e=>{var i;return e._id!==(null===x||void 0===x||null===(i=x.data)||void 0===i?void 0:i._id)})),G=async()=>{const e=await(0,b.de)(n);if(e.success&&(H((0,w.wi)(e.data)),x.data&&x.data._id&&Object.values(x.data).every((e=>void 0!==typeof e)))){let i={action:"seen",sender:{...x.data,userType:"student"},recievers:null===L||void 0===L?void 0:L.participants.filter((e=>{var i;return e._id!==(null===(i=x.data)||void 0===i?void 0:i._id)})),data:e.data};C.A.emit("trigger",i)}},U=async e=>{let i;switch(e.name){case"send":const s=new FormData;s.append("content",e.data),s.append("chatId",n);try{if(e.data.trim()){const i=await(0,b._N)(s);D("Ava is typing"),i.data.success?(H((0,w.wi)(i.data.data.chat)),H((0,_.tj)(i.data.data.message)),z([])):console.error("Failed to send message or upload files.");const t=await(0,b.G5)({content:e.data,chatId:n});D(""),t.data.success?(H((0,w.wi)(t.data.data.chat)),H((0,_.tj)(t.data.data.message))):console.error("Failed to send message or upload files.")}}catch(t){console.error("Error during file upload or message sending:",t)}break;case"startTyping":i={action:"typing",sender:{...x.data,userType:"student"},recievers:null===L||void 0===L?void 0:L.participants.filter((e=>{var i;return e._id!=(null===(i=x.data)||void 0===i?void 0:i._id)})),data:"start"}}};(0,u.useEffect)((()=>{(async()=>{try{S(!0);const e=await(0,b.qH)(n);if(e){let i=e.data.map((e=>({...e,type:"normal"})));i.reverse(),H((0,_.bq)({requestStatus:"initiated",responseStatus:"recieved",haveAnIssue:!1,issue:"",data:i})),0!=(null===L||void 0===L?void 0:L.unSeenMessages.filter((e=>{var i;return e.message.sender._id!==(null===(i=x.data)||void 0===i?void 0:i._id)})).filter((e=>!e.seen.find((e=>{var i;return e===(null===(i=x.data)||void 0===i?void 0:i._id)})))).length)&&await G()}S(!1)}catch(e){S(!1)}})()}),[]),g.current=L&&x.data?((e,i,t)=>{let n=i.participants.filter((e=>e._id!=t._id)),s=[],l=[];e.reverse(),e.forEach((e=>{var o;if((null===(o=e.sender)||void 0===o?void 0:o._id)==t._id)if(0!=n.length){if(0==i.unSeenMessages.length?0!=n.length&&(l=[...n]):l=i.unSeenMessages.find((i=>i.message._id==e._id))?n.filter((t=>{var n;return null===(n=i.unSeenMessages.find((i=>i.message._id==e._id)))||void 0===n?void 0:n.seen.find((e=>e==t._id))})):[...n],0!=l.length){let t=l.reduce(((e,i)=>e+i.firstName+" , "),"Seen by ");s.push({_id:e._id+"_seen",type:"seen",content:t.substring(0,t.length-3),chat:i._id})}s.push(e),n=n.filter((e=>!l.find((i=>i._id==e._id))))}else s.push(e);else s.push(e)})),s.reverse();let o=i.participants.filter((e=>"typing"==e.activity));if(0!=o.length){let e=o.reduce(((e,i)=>i.firstName+" , "),"");s.push({_id:i._id+"_typing",type:"typing",content:e.substring(0,e.length-3)+(1==o.length?" is typing":" are typing"),chat:i._id,sender:{displayPicSrc:"",firstName:"",lastName:"",email:"",_id:i._id+"_typing",userType:""}})}return s})([...F.data],L,x.data):[];const q=e=>(0,I.jsx)("div",{style:{background:"#F8F8FC",padding:"0.5rem",borderRadius:"0.8rem",position:"relative"},children:(0,I.jsxs)(d.A,{direction:"row",spacing:2,alignItems:"center",justifyContent:"space-between",children:[(0,I.jsxs)(s.A,{sx:{display:"flex",gap:"1rem",alignItems:"center"},children:[(0,I.jsx)(o.A,{src:"Virtual_Assistant"===(null===W||void 0===W?void 0:W.role)?y.A.ai:null===W||void 0===W?void 0:W.displayPicSrc,alt:"profile",sx:{width:"3rem",height:"3rem",borderRadius:"50%"}}),(0,I.jsx)(r.A,{fontWeight:"500",sx:{position:"absolute",right:"10px",top:"-1rem",background:"#fff",p:1,borderRadius:"10px",color:"counsellor"===(null===W||void 0===W?void 0:W.role)?"#3B3F76":"processCoordinator"===(null===W||void 0===W?void 0:W.role)?"#569228":"#FEB853",fontSize:"14px"},children:null!==W&&void 0!==W&&W.role?(0,f.AZ)(null===W||void 0===W?void 0:W.role):null===W||void 0===W?void 0:W.role}),(0,I.jsx)(s.A,{children:null!==W&&void 0!==W&&W.firstName||null!==W&&void 0!==W&&W.lastName?(0,I.jsxs)(r.A,{fontWeight:"500",children:[(0,f.r0)(null===W||void 0===W?void 0:W.firstName),"\xa0",(0,f.r0)(null===W||void 0===W?void 0:W.lastName)]}):(0,I.jsx)(r.A,{children:"User"})})]}),(0,I.jsx)(s.A,{sx:{float:"right"},children:(0,I.jsx)(a.A,{sx:{textTransform:"none",color:"#3b3f76",float:"right"},onClick:()=>e.eventHandler({name:"block",data:{action:"block",id:null===W||void 0===W?void 0:W._id}}),children:W&&"Virtual_Assistant"!==(null===W||void 0===W?void 0:W.role)&&"Block"})})]})}),Y=e=>{const i=(0,u.useRef)(null),t=(0,u.useRef)(null),[n,l]=(0,u.useState)(!0);return(0,u.useEffect)((()=>{var e;n&&(null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"auto"}))}),[g.current]),(0,u.useEffect)((()=>{var e;null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"auto"})}),[]),(0,I.jsx)(s.A,{ref:t,onScroll:()=>{if(t.current){const{scrollTop:e,scrollHeight:i,clientHeight:n}=t.current;l(i-e-n<=5)}},sx:{overflowY:"scroll",mt:3,height:"390px","&::-webkit-scrollbar":{width:"12px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"transparent",borderRadius:"8px"}},children:A?(0,I.jsx)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"300px"},children:(0,I.jsx)(m.A,{})}):(0,I.jsx)("div",{className:"chat-container",children:g.current.length>0?(0,I.jsxs)(I.Fragment,{children:[g.current.map((e=>{var i,t,n,s,l,r,d,a,c;return(0,I.jsx)(I.Fragment,{children:"seen"!==e.type&&"typing"!==e.type?(0,I.jsxs)("div",{className:"message ".concat((null===e||void 0===e||null===(i=e.sender)||void 0===i?void 0:i._id)===(null===(t=x.data)||void 0===t?void 0:t._id)?"sent":"received"),children:[(0,I.jsx)(R,{content:e.content}),null!==e&&void 0!==e&&null!==(n=e.document)&&void 0!==n&&null!==(s=n.data)&&void 0!==s&&s.preview_url?(0,I.jsx)("iframe",{src:null===e||void 0===e||null===(l=e.document)||void 0===l||null===(r=l.data)||void 0===r?void 0:r.preview_url,title:"preview",style:{border:"none",width:"150px",height:"150px",objectFit:"contain"}}):"",(0,I.jsx)(o.A,{src:null===(d=e.sender)||void 0===d?void 0:d.displayPicSrc,alt:"",sx:(null===e||void 0===e||null===(a=e.sender)||void 0===a?void 0:a._id)===(null===(c=x.data)||void 0===c?void 0:c._id)?{width:"1.5rem",height:"1.5rem",borderRadius:"50%",position:"absolute",top:"-12px",right:0}:{width:"1.5rem",height:"1.5rem",borderRadius:"50%",position:"absolute",top:"-12px",left:0}})]},e._id):(0,I.jsx)(I.Fragment,{children:(0,I.jsx)("div",{className:"seenMsg",children:e.content},e._id)})})})),P&&(0,I.jsx)(r.A,{sx:{textAlign:"right",fontSize:"13px",color:"#3b3f76",marginTop:"8px"},children:P}),(0,I.jsx)("div",{ref:i})]}):(0,I.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,I.jsxs)(r.A,{sx:{fontSize:"14px"},children:["Hi, How can I help you ? Here are few questions"," "]}),["Top courses in USA?","Best universities in Computer Science ?"].map(((i,t)=>(0,I.jsx)(ee.A,{sx:{fontSize:"14px",textDecoration:"none",cursor:"pointer"},onClick:()=>e.eventHandler({name:"send",data:i}),children:i},t)))]})})})},Z=e=>{const[i,t]=(0,u.useState)(""),[n,s]=(0,u.useState)(!1),l=((0,u.useRef)(null),async()=>{try{""!==i.trim()||M&&M.length>0?(s(!0),await e.eventHandler({name:"send",data:i})):console.log("No content or files to send.")}catch(t){console.error("Error while sending:",t)}finally{s(!1)}});return(0,I.jsx)(I.Fragment,{children:W&&(0,I.jsxs)("div",{style:{position:"relative"},children:[(null===M||void 0===M?void 0:M.length)>0&&(0,I.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",position:"absolute",top:"-44px",right:"35%"},children:(0,I.jsxs)("div",{style:{width:"fitContent"},children:[(0,I.jsx)(r.A,{fontSize:"0.9rem",children:"Selected files:"}),(0,I.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:M.map(((e,i)=>(0,I.jsxs)("li",{style:{fontSize:"12px",display:"flex"},children:[e.name,(0,I.jsx)(k.A,{onClick:()=>(e=>{const i=[...M];i.splice(e,1),z(i)})(i),sx:{fontSize:"1rem",cursor:"pointer"}})]},i)))})]})}),B?(0,I.jsx)("div",{className:"replyDiv",children:(0,I.jsxs)("h5",{children:["reply to:- ",V]})}):"",(0,I.jsxs)(h.Ay,{container:!0,sx:{background:"#F8F8FC",padding:"0.5rem",borderRadius:"0.8rem"},children:[(0,I.jsx)(h.Ay,{item:!0,xs:9.5,children:(0,I.jsx)(p.A,{variant:"outlined",size:"small",onFocus:()=>e.eventHandler({name:"startTyping"}),onBlur:()=>e.eventHandler({name:"stopTyping"}),multiline:!0,rows:2,fullWidth:!0,placeholder:"Type your message...",value:i,sx:{"& .MuiOutlinedInput-notchedOutline":{border:0,"&:Focus":{border:0}},"& .Mui-focused .MuiOutlinedInput-notchedOutline":{border:"none !important"}},onChange:e=>t(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||""===i.trim()||(e.preventDefault(),l())}})}),(0,I.jsx)(h.Ay,{item:!0,xs:1.5,sx:{display:"flex",justifyContent:"center",alignItems:"center",background:"#fff",borderRadius:"6px"},children:n?(0,I.jsx)("img",{src:y.A.standardLoader,alt:"loader",style:{width:"1rem"}}):(0,I.jsx)("img",{src:y.A.sendIcon,alt:"sendIcon",style:{width:"2rem",height:"2rem"},onClick:l})})]})]})})};return(0,I.jsx)("div",{children:(0,I.jsxs)(c.A,{open:i,sx:{right:"0",left:{md:"45%",xs:"0",lg:"68%"},top:{md:"10px",xs:"0",lg:"25px"}},PaperProps:{style:{borderRadius:"1rem",padding:"1rem",width:"410px",height:"582px"}},TransitionComponent:ie,keepMounted:!0,onClose:()=>t(!1),"aria-describedby":"alert-dialog-slide-description",children:[(0,I.jsx)(s.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,I.jsx)(j.A,{sx:{position:"absolute",top:0,color:"#0F0F0F",fontSize:"2rem",cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>t(!1)})}),(0,I.jsxs)(s.A,{sx:{mt:3},children:[(0,I.jsx)(q,{eventHandler:U}),(0,I.jsx)(Y,{eventHandler:U}),(0,I.jsx)(Z,{eventHandler:U})]})]})})};var ne=t(64644);const se=e=>{var i,t;const[n,s]=(0,u.useState)(!1),[l,o]=(0,u.useState)(!1),r=(0,v.jL)(),[d,a]=(0,u.useState)(null),c=(0,v.GV)((e=>e.userAuthStatus)),p=e=>{a(e)},x=()=>{a(null)},h=(0,v.GV)((e=>e.chats)),g=(e=>{for(const t of e){var i;if(null===t||void 0===t||null===(i=t.participants)||void 0===i?void 0:i.find((e=>"Virtual_Assistant"===e.role)))return t}return null})(null===h||void 0===h||null===(i=h.data)||void 0===i?void 0:i.advisors);return(0,I.jsxs)("div",{style:{position:"fixed",bottom:16,right:16,zIndex:1600},children:[(0,I.jsxs)(K.A,{ariaLabel:"Custom SpeedDial",icon:n?(0,I.jsx)(X.A,{style:{color:"white",fontSize:"28px"}}):(0,I.jsx)($.A,{style:{color:"white",fontSize:"28px"}}),onClick:()=>{e.setOpen(!0),r((0,ne.JJ)())},open:n,direction:"up",FabProps:{style:{backgroundColor:"#3b3f76",color:"white"}},children:[(0,I.jsx)(Q.A,{icon:(0,I.jsx)("img",{style:{width:"3rem",height:"3rem",cursor:"pointer"},src:y.A.chaticon,alt:"chat icon"}),tooltipOpen:"chat"===d,tooltipTitle:(0,I.jsx)("div",{style:{width:"120px",textAlign:"center"},children:"Chat with us"}),onClick:()=>{e.setOpen(!0),r((0,ne.JJ)())},onMouseEnter:()=>p("chat"),onMouseLeave:x}),(0,I.jsx)(Q.A,{icon:(0,I.jsx)("img",{style:{width:"1.7rem",height:"1.7rem",cursor:"pointer",filter:"invert(1)"},src:y.A.ai,alt:"AI chat icon"}),FabProps:{style:{backgroundColor:"#3b3f76",color:"white",width:"45px",height:"45px"}},tooltipOpen:"ai"===d,tooltipTitle:(0,I.jsx)("div",{style:{width:"120px",textAlign:"center"},children:"Chat with AI"}),onClick:()=>{var e;null!==(e=c.data)&&void 0!==e&&e.isAuthorized?o(!0):r((0,S.DE)({show:!0,data:{container:{name:"login",dimensions:{width:"800px",height:"70%",show:"none"}},type:"custom"}}))},onMouseEnter:()=>p("ai"),onMouseLeave:x})]}),null!==(t=c.data)&&void 0!==t&&t.isAuthorized&&l?(0,I.jsx)(te,{open:l,setOpen:o,id:null===g||void 0===g?void 0:g._id,type:"advisors"}):null]})},le=u.forwardRef((function(e,i){return(0,I.jsx)(n.A,{direction:"up",ref:i,...e})})),oe=()=>{const e=(0,v.jL)();return(0,I.jsxs)("div",{style:{background:"#EDF2F6",padding:"1.5rem",borderRadius:"10px",position:"relative"},children:[(0,I.jsxs)(s.A,{sx:{display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"start",mb:2},children:[(0,I.jsxs)(l.A,{max:4,children:[(0,I.jsx)(o.A,{alt:"Remy Sharp",src:"/static/images/avatar/1.jpg"}),(0,I.jsx)(o.A,{alt:"Travis Howard",src:"/static/images/avatar/2.jpg"}),(0,I.jsx)(o.A,{alt:"Cindy Baker",src:"/static/images/avatar/3.jpg"}),(0,I.jsx)(o.A,{alt:"Agnes Walker",src:"/static/images/avatar/4.jpg"}),(0,I.jsx)(o.A,{alt:"Trevor Henderson",src:"/static/images/avatar/5.jpg"})]}),(0,I.jsx)(r.A,{color:"#3B3F76",fontWeight:"600",gutterBottom:!0,children:"Say goodbye to all your doubts !"}),(0,I.jsxs)(r.A,{color:"rgba(48, 51, 99, 0.5)",gutterBottom:!0,children:["As you say hello to our profound advisors !"," "]})]}),(0,I.jsxs)(s.A,{sx:{background:"#fff",p:2,borderRadius:"10px",position:"absolute",left:"20px",right:"20px",boxShadow:"2",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[(0,I.jsxs)(r.A,{gutterBottom:!0,children:["Login to start chat with"," ",(0,I.jsx)("span",{style:{color:"rgba(48, 51, 99, 0.5)"},children:"Students "}),"and ",(0,I.jsx)("span",{style:{color:"rgba(48, 51, 99, 0.5)"},children:"Advisors"}),"."]}),(0,I.jsx)(U.S,{width:"100px",handleSubmit:()=>{e((0,S.DE)({show:!0,data:{container:{name:"login",dimensions:{width:"800px",height:"70%",show:"none"}},type:"custom"}}))},children:"Login"})]})]})},re=()=>{var e;const i=(0,v.GV)((e=>e.userAuthStatus)),t=(0,v.GV)((e=>e.chatUI)),[n,l]=(0,u.useState)(!1),[o,r]=(0,u.useState)(!1),p=(0,v.jL)();(0,u.useEffect)((()=>{t.data.isOpen!==n&&l(t.data.isOpen)}),[t.data.isOpen]);const x=()=>{const[e,i]=(0,u.useState)("advisors");return(0,I.jsxs)(d.A,{spacing:1,sx:{height:"480px",p:2,justifyContent:"center",alignItems:"center"},children:[(0,I.jsxs)(s.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"80%",gap:"1rem"},children:[(0,I.jsx)(a.A,{onClick:()=>i("advisors"),sx:{borderBottom:"advisors"===e?"2px solid #3B3F76":0,color:"advisors"===e?"#3B3F76":"#3b3f7699",borderRadius:0,textTransform:"none",fontSize:"0.9rem"},children:"Advisors"}),(0,I.jsx)(a.A,{onClick:()=>i("community"),sx:{borderBottom:"community"===e?"2px solid #3B3F76":0,color:"community"===e?"#3B3F76":"#3b3f7699",textTransform:"none",borderRadius:0,fontSize:"0.9rem"},children:"Community"}),(0,I.jsx)(a.A,{onClick:()=>i("avaLite"),sx:{borderBottom:"avaLite"===e?"2px solid #3B3F76":0,color:"avaLite"===e?"#3B3F76":"#3b3f7699",textTransform:"none",borderRadius:0,fontSize:"0.9rem"},children:"Ava Lite"})]}),"advisors"===e?(0,I.jsx)(D,{}):"community"===e?(0,I.jsx)(H,{}):"avaLite"===e?(0,I.jsx)(W,{}):"",(0,I.jsx)("div",{style:{position:"absolute",bottom:"12px",right:"12px"},children:(0,I.jsx)("div",{onClick:()=>r(!0),style:{background:"#3B3F76",color:"#fff",height:"1rem",width:"1rem",borderRadius:"50%",padding:"0.2rem",cursor:"pointer"},children:(0,I.jsx)(G.A,{sx:{fontSize:"1rem"}})})})]})};return(0,I.jsx)("div",{children:(0,I.jsxs)("div",{children:[(0,I.jsx)(se,{setOpen:l}),(0,I.jsx)(c.A,{open:n,sx:{right:"0",left:{md:"45%",xs:"0",lg:"68%"},top:{md:"1%",xs:"0",lg:"5%"}},PaperProps:{style:{borderRadius:"1rem",padding:"1rem",width:"410px",height:"550px"}},TransitionComponent:le,keepMounted:!0,onClose:()=>{l(!1),p((0,ne.vt)())},"aria-describedby":"alert-dialog-slide-description",children:(0,I.jsxs)(s.A,{children:[(0,I.jsx)(s.A,{sx:{display:"flex",justifyContent:"center"},children:(0,I.jsx)(j.A,{onClick:()=>{l(!1),p((0,ne.vt)())},sx:{position:"absolute",top:0,color:"#0F0F0F",fontSize:"2rem",cursor:"pointer",display:"flex",justifyContent:"center",alignItems:"center"}})}),null!==(e=i.data)&&void 0!==e&&e.isAuthorized?(0,I.jsx)(x,{}):(0,I.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",height:"50vh"},children:(0,I.jsx)(oe,{})})]})}),o?(0,I.jsx)(J,{open:o,setOpen:r}):""]})})}}}]);
//# sourceMappingURL=416.84e5fa2c.chunk.js.map